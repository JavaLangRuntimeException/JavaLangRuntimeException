"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/link-preview-js";
exports.ids = ["vendor-chunks/link-preview-js"];
exports.modules = {

/***/ "(action-browser)/./node_modules/link-preview-js/build/constants.js":
/*!*********************************************************!*\
  !*** ./node_modules/link-preview-js/build/constants.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.CONSTANTS = void 0;\nexports.CONSTANTS = {\n    REGEX_VALID_URL: new RegExp(\"^\" +\n        // protocol identifier\n        \"(?:(?:https?|ftp)://)\" +\n        // user:pass authentication\n        \"(?:\\\\S+(?::\\\\S*)?@)?\" +\n        \"(?:\" +\n        // IP address exclusion\n        // private & local networks\n        \"(?!(?:10|127)(?:\\\\.\\\\d{1,3}){3})\" +\n        \"(?!(?:169\\\\.254|192\\\\.168)(?:\\\\.\\\\d{1,3}){2})\" +\n        \"(?!172\\\\.(?:1[6-9]|2\\\\d|3[0-1])(?:\\\\.\\\\d{1,3}){2})\" +\n        // IP address dotted notation octets\n        // excludes loopback network 0.0.0.0\n        // excludes reserved space >= 224.0.0.0\n        // excludes network & broacast addresses\n        // (first & last IP address of each class)\n        \"(?:[1-9]\\\\d?|1\\\\d\\\\d|2[01]\\\\d|22[0-3])\" +\n        \"(?:\\\\.(?:1?\\\\d{1,2}|2[0-4]\\\\d|25[0-5])){2}\" +\n        \"(?:\\\\.(?:[1-9]\\\\d?|1\\\\d\\\\d|2[0-4]\\\\d|25[0-4]))\" +\n        \"|\" +\n        // host name\n        \"(?:(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)\" +\n        // domain name\n        \"(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)*\" +\n        // TLD identifier\n        \"(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff]{2,}))\" +\n        // TLD may end with dot\n        \"\\\\.?\" +\n        \")\" +\n        // port number\n        \"(?::\\\\d{2,5})?\" +\n        // resource path\n        \"(?:[/?#]\\\\S*)?\" +\n        \"$\", \"i\"),\n    REGEX_LOOPBACK: new RegExp(\"^\" +\n        // Loopback: 127.0.0.0 - 127.255.255.255\n        \"(?:127(?:\\\\.\\\\d{1,3}){3})\" +\n        \"|\" +\n        // Private Class A: 10.0.0.0 - 10.255.255.255\n        \"(?:10(?:\\\\.\\\\d{1,3}){3})\" +\n        \"|\" +\n        // Private Class B: 172.16.0.0 - 172.31.255.255\n        \"(?:172\\\\.(?:1[6-9]|2\\\\d|3[0-1])(?:\\\\.\\\\d{1,3}){2})\" +\n        \"|\" +\n        // Private Class C: 192.168.0.0 - 192.168.255.255\n        \"(?:192\\\\.168(?:\\\\.\\\\d{1,3}){2})\" +\n        \"|\" +\n        // Link-local: 169.254.0.0 - 169.254.255.255\n        \"(?:169\\\\.254(?:\\\\.\\\\d{1,3}){2})\" +\n        \"|\" +\n        // Documentation: 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24\n        \"(?:192\\\\.0\\\\.2(?:\\\\.\\\\d{1,3}){1})\" +\n        \"|\" +\n        \"(?:198\\\\.51\\\\.100(?:\\\\.\\\\d{1,3}){1})\" +\n        \"|\" +\n        \"(?:203\\\\.0\\\\.113(?:\\\\.\\\\d{1,3}){1})\" +\n        \"|\" +\n        // Carrier-Grade NAT (CGNAT): 100.64.0.0 - 100.127.255.255\n        \"(?:100\\\\.(?:6[4-9]|[7-9]\\\\d|1[0-1]\\\\d)(?:\\\\.\\\\d{1,3}){2})\" +\n        \"$\", \"i\"),\n    REGEX_CONTENT_TYPE_IMAGE: new RegExp(\"image/.*\", \"i\"),\n    REGEX_CONTENT_TYPE_AUDIO: new RegExp(\"audio/.*\", \"i\"),\n    REGEX_CONTENT_TYPE_VIDEO: new RegExp(\"video/.*\", \"i\"),\n    REGEX_CONTENT_TYPE_TEXT: new RegExp(\"text/.*\", \"i\"),\n    REGEX_CONTENT_TYPE_APPLICATION: new RegExp(\"application/.*\", \"i\"),\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9saW5rLXByZXZpZXctanMvYnVpbGQvY29uc3RhbnRzLmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGlCQUFpQjtBQUNqQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxJQUFJLEVBQUUsRUFBRTtBQUN4Qyw2Q0FBNkMsSUFBSSxFQUFFLEVBQUU7QUFDckQsa0RBQWtELElBQUksRUFBRSxFQUFFO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixJQUFJLHFCQUFxQixFQUFFO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLEdBQUc7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsSUFBSTtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLElBQUksRUFBRSxFQUFFO0FBQ2pDO0FBQ0E7QUFDQSx3QkFBd0IsSUFBSSxFQUFFLEVBQUU7QUFDaEM7QUFDQTtBQUNBLGtEQUFrRCxJQUFJLEVBQUUsRUFBRTtBQUMxRDtBQUNBO0FBQ0EsK0JBQStCLElBQUksRUFBRSxFQUFFO0FBQ3ZDO0FBQ0E7QUFDQSwrQkFBK0IsSUFBSSxFQUFFLEVBQUU7QUFDdkM7QUFDQTtBQUNBLGlDQUFpQyxJQUFJLEVBQUUsRUFBRTtBQUN6QztBQUNBLG9DQUFvQyxJQUFJLEVBQUUsRUFBRTtBQUM1QztBQUNBLG1DQUFtQyxJQUFJLEVBQUUsRUFBRTtBQUMzQztBQUNBO0FBQ0EseURBQXlELElBQUksRUFBRSxFQUFFO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvbW50L2MvVXNlcnMvdGFuYWgvZ2l0L0phdmFMYW5nUnVudGltZUV4Y2VwdGlvbi5naXRodWIuaW8vbm9kZV9tb2R1bGVzL2xpbmstcHJldmlldy1qcy9idWlsZC9jb25zdGFudHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNPTlNUQU5UUyA9IHZvaWQgMDtcbmV4cG9ydHMuQ09OU1RBTlRTID0ge1xuICAgIFJFR0VYX1ZBTElEX1VSTDogbmV3IFJlZ0V4cChcIl5cIiArXG4gICAgICAgIC8vIHByb3RvY29sIGlkZW50aWZpZXJcbiAgICAgICAgXCIoPzooPzpodHRwcz98ZnRwKTovLylcIiArXG4gICAgICAgIC8vIHVzZXI6cGFzcyBhdXRoZW50aWNhdGlvblxuICAgICAgICBcIig/OlxcXFxTKyg/OjpcXFxcUyopP0ApP1wiICtcbiAgICAgICAgXCIoPzpcIiArXG4gICAgICAgIC8vIElQIGFkZHJlc3MgZXhjbHVzaW9uXG4gICAgICAgIC8vIHByaXZhdGUgJiBsb2NhbCBuZXR3b3Jrc1xuICAgICAgICBcIig/ISg/OjEwfDEyNykoPzpcXFxcLlxcXFxkezEsM30pezN9KVwiICtcbiAgICAgICAgXCIoPyEoPzoxNjlcXFxcLjI1NHwxOTJcXFxcLjE2OCkoPzpcXFxcLlxcXFxkezEsM30pezJ9KVwiICtcbiAgICAgICAgXCIoPyExNzJcXFxcLig/OjFbNi05XXwyXFxcXGR8M1swLTFdKSg/OlxcXFwuXFxcXGR7MSwzfSl7Mn0pXCIgK1xuICAgICAgICAvLyBJUCBhZGRyZXNzIGRvdHRlZCBub3RhdGlvbiBvY3RldHNcbiAgICAgICAgLy8gZXhjbHVkZXMgbG9vcGJhY2sgbmV0d29yayAwLjAuMC4wXG4gICAgICAgIC8vIGV4Y2x1ZGVzIHJlc2VydmVkIHNwYWNlID49IDIyNC4wLjAuMFxuICAgICAgICAvLyBleGNsdWRlcyBuZXR3b3JrICYgYnJvYWNhc3QgYWRkcmVzc2VzXG4gICAgICAgIC8vIChmaXJzdCAmIGxhc3QgSVAgYWRkcmVzcyBvZiBlYWNoIGNsYXNzKVxuICAgICAgICBcIig/OlsxLTldXFxcXGQ/fDFcXFxcZFxcXFxkfDJbMDFdXFxcXGR8MjJbMC0zXSlcIiArXG4gICAgICAgIFwiKD86XFxcXC4oPzoxP1xcXFxkezEsMn18MlswLTRdXFxcXGR8MjVbMC01XSkpezJ9XCIgK1xuICAgICAgICBcIig/OlxcXFwuKD86WzEtOV1cXFxcZD98MVxcXFxkXFxcXGR8MlswLTRdXFxcXGR8MjVbMC00XSkpXCIgK1xuICAgICAgICBcInxcIiArXG4gICAgICAgIC8vIGhvc3QgbmFtZVxuICAgICAgICBcIig/Oig/OlthLXpcXFxcdTAwYTEtXFxcXHVmZmZmMC05XS0qKSpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZjAtOV0rKVwiICtcbiAgICAgICAgLy8gZG9tYWluIG5hbWVcbiAgICAgICAgXCIoPzpcXFxcLig/OlthLXpcXFxcdTAwYTEtXFxcXHVmZmZmMC05XS0qKSpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZjAtOV0rKSpcIiArXG4gICAgICAgIC8vIFRMRCBpZGVudGlmaWVyXG4gICAgICAgIFwiKD86XFxcXC4oPzpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZl17Mix9KSlcIiArXG4gICAgICAgIC8vIFRMRCBtYXkgZW5kIHdpdGggZG90XG4gICAgICAgIFwiXFxcXC4/XCIgK1xuICAgICAgICBcIilcIiArXG4gICAgICAgIC8vIHBvcnQgbnVtYmVyXG4gICAgICAgIFwiKD86OlxcXFxkezIsNX0pP1wiICtcbiAgICAgICAgLy8gcmVzb3VyY2UgcGF0aFxuICAgICAgICBcIig/OlsvPyNdXFxcXFMqKT9cIiArXG4gICAgICAgIFwiJFwiLCBcImlcIiksXG4gICAgUkVHRVhfTE9PUEJBQ0s6IG5ldyBSZWdFeHAoXCJeXCIgK1xuICAgICAgICAvLyBMb29wYmFjazogMTI3LjAuMC4wIC0gMTI3LjI1NS4yNTUuMjU1XG4gICAgICAgIFwiKD86MTI3KD86XFxcXC5cXFxcZHsxLDN9KXszfSlcIiArXG4gICAgICAgIFwifFwiICtcbiAgICAgICAgLy8gUHJpdmF0ZSBDbGFzcyBBOiAxMC4wLjAuMCAtIDEwLjI1NS4yNTUuMjU1XG4gICAgICAgIFwiKD86MTAoPzpcXFxcLlxcXFxkezEsM30pezN9KVwiICtcbiAgICAgICAgXCJ8XCIgK1xuICAgICAgICAvLyBQcml2YXRlIENsYXNzIEI6IDE3Mi4xNi4wLjAgLSAxNzIuMzEuMjU1LjI1NVxuICAgICAgICBcIig/OjE3MlxcXFwuKD86MVs2LTldfDJcXFxcZHwzWzAtMV0pKD86XFxcXC5cXFxcZHsxLDN9KXsyfSlcIiArXG4gICAgICAgIFwifFwiICtcbiAgICAgICAgLy8gUHJpdmF0ZSBDbGFzcyBDOiAxOTIuMTY4LjAuMCAtIDE5Mi4xNjguMjU1LjI1NVxuICAgICAgICBcIig/OjE5MlxcXFwuMTY4KD86XFxcXC5cXFxcZHsxLDN9KXsyfSlcIiArXG4gICAgICAgIFwifFwiICtcbiAgICAgICAgLy8gTGluay1sb2NhbDogMTY5LjI1NC4wLjAgLSAxNjkuMjU0LjI1NS4yNTVcbiAgICAgICAgXCIoPzoxNjlcXFxcLjI1NCg/OlxcXFwuXFxcXGR7MSwzfSl7Mn0pXCIgK1xuICAgICAgICBcInxcIiArXG4gICAgICAgIC8vIERvY3VtZW50YXRpb246IDE5Mi4wLjIuMC8yNCwgMTk4LjUxLjEwMC4wLzI0LCAyMDMuMC4xMTMuMC8yNFxuICAgICAgICBcIig/OjE5MlxcXFwuMFxcXFwuMig/OlxcXFwuXFxcXGR7MSwzfSl7MX0pXCIgK1xuICAgICAgICBcInxcIiArXG4gICAgICAgIFwiKD86MTk4XFxcXC41MVxcXFwuMTAwKD86XFxcXC5cXFxcZHsxLDN9KXsxfSlcIiArXG4gICAgICAgIFwifFwiICtcbiAgICAgICAgXCIoPzoyMDNcXFxcLjBcXFxcLjExMyg/OlxcXFwuXFxcXGR7MSwzfSl7MX0pXCIgK1xuICAgICAgICBcInxcIiArXG4gICAgICAgIC8vIENhcnJpZXItR3JhZGUgTkFUIChDR05BVCk6IDEwMC42NC4wLjAgLSAxMDAuMTI3LjI1NS4yNTVcbiAgICAgICAgXCIoPzoxMDBcXFxcLig/OjZbNC05XXxbNy05XVxcXFxkfDFbMC0xXVxcXFxkKSg/OlxcXFwuXFxcXGR7MSwzfSl7Mn0pXCIgK1xuICAgICAgICBcIiRcIiwgXCJpXCIpLFxuICAgIFJFR0VYX0NPTlRFTlRfVFlQRV9JTUFHRTogbmV3IFJlZ0V4cChcImltYWdlLy4qXCIsIFwiaVwiKSxcbiAgICBSRUdFWF9DT05URU5UX1RZUEVfQVVESU86IG5ldyBSZWdFeHAoXCJhdWRpby8uKlwiLCBcImlcIiksXG4gICAgUkVHRVhfQ09OVEVOVF9UWVBFX1ZJREVPOiBuZXcgUmVnRXhwKFwidmlkZW8vLipcIiwgXCJpXCIpLFxuICAgIFJFR0VYX0NPTlRFTlRfVFlQRV9URVhUOiBuZXcgUmVnRXhwKFwidGV4dC8uKlwiLCBcImlcIiksXG4gICAgUkVHRVhfQ09OVEVOVF9UWVBFX0FQUExJQ0FUSU9OOiBuZXcgUmVnRXhwKFwiYXBwbGljYXRpb24vLipcIiwgXCJpXCIpLFxufTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/./node_modules/link-preview-js/build/constants.js\n");

/***/ }),

/***/ "(action-browser)/./node_modules/link-preview-js/build/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/link-preview-js/build/index.js ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

eval("\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.getPreviewFromContent = exports.getLinkPreview = void 0;\nvar cheerio_1 = __importDefault(__webpack_require__(/*! cheerio */ \"(action-browser)/./node_modules/cheerio/lib/index.js\"));\nvar cross_fetch_1 = __webpack_require__(/*! cross-fetch */ \"(action-browser)/./node_modules/cross-fetch/dist/node-ponyfill.js\");\nvar abort_controller_1 = __importDefault(__webpack_require__(/*! abort-controller */ \"(action-browser)/./node_modules/abort-controller/dist/abort-controller.js\"));\nvar url_1 = __importDefault(__webpack_require__(/*! url */ \"url\"));\nvar constants_1 = __webpack_require__(/*! ./constants */ \"(action-browser)/./node_modules/link-preview-js/build/constants.js\");\nfunction throwOnLoopback(address) {\n    if (constants_1.CONSTANTS.REGEX_LOOPBACK.test(address)) {\n        throw new Error(\"SSRF request detected, trying to query host\");\n    }\n}\nfunction metaTag(doc, type, attr) {\n    var nodes = doc(\"meta[\".concat(attr, \"='\").concat(type, \"']\"));\n    return nodes.length ? nodes : null;\n}\nfunction metaTagContent(doc, type, attr) {\n    return doc(\"meta[\".concat(attr, \"='\").concat(type, \"']\")).attr(\"content\");\n}\nfunction getTitle(doc) {\n    var title = metaTagContent(doc, \"og:title\", \"property\") ||\n        metaTagContent(doc, \"og:title\", \"name\");\n    if (!title) {\n        title = doc(\"head > title\").text();\n    }\n    return title;\n}\nfunction getSiteName(doc) {\n    var siteName = metaTagContent(doc, \"og:site_name\", \"property\") ||\n        metaTagContent(doc, \"og:site_name\", \"name\");\n    return siteName;\n}\nfunction getDescription(doc) {\n    var description = metaTagContent(doc, \"description\", \"name\") ||\n        metaTagContent(doc, \"Description\", \"name\") ||\n        metaTagContent(doc, \"og:description\", \"property\");\n    return description;\n}\nfunction getMediaType(doc) {\n    var node = metaTag(doc, \"medium\", \"name\");\n    if (node) {\n        var content = node.attr(\"content\");\n        return content === \"image\" ? \"photo\" : content;\n    }\n    return (metaTagContent(doc, \"og:type\", \"property\") ||\n        metaTagContent(doc, \"og:type\", \"name\"));\n}\nfunction getImages(doc, rootUrl, imagesPropertyType) {\n    var images = [];\n    var nodes;\n    var src;\n    var dic = {};\n    var imagePropertyType = imagesPropertyType !== null && imagesPropertyType !== void 0 ? imagesPropertyType : \"og\";\n    nodes =\n        metaTag(doc, \"\".concat(imagePropertyType, \":image\"), \"property\") ||\n            metaTag(doc, \"\".concat(imagePropertyType, \":image\"), \"name\");\n    if (nodes) {\n        nodes.each(function (_, node) {\n            if (node.type === \"tag\") {\n                src = node.attribs.content;\n                if (src) {\n                    src = url_1.default.resolve(rootUrl, src);\n                    images.push(src);\n                }\n            }\n        });\n    }\n    if (images.length <= 0 && !imagesPropertyType) {\n        src = doc(\"link[rel=image_src]\").attr(\"href\");\n        if (src) {\n            src = url_1.default.resolve(rootUrl, src);\n            images = [src];\n        }\n        else {\n            nodes = doc(\"img\");\n            if (nodes === null || nodes === void 0 ? void 0 : nodes.length) {\n                dic = {};\n                images = [];\n                nodes.each(function (_, node) {\n                    if (node.type === \"tag\")\n                        src = node.attribs.src;\n                    if (src && !dic[src]) {\n                        dic[src] = true;\n                        // width = node.attribs.width;\n                        // height = node.attribs.height;\n                        images.push(url_1.default.resolve(rootUrl, src));\n                    }\n                });\n            }\n        }\n    }\n    return images;\n}\nfunction getVideos(doc) {\n    var videos = [];\n    var nodeTypes;\n    var nodeSecureUrls;\n    var nodeType;\n    var nodeSecureUrl;\n    var video;\n    var videoType;\n    var videoSecureUrl;\n    var width;\n    var height;\n    var videoObj;\n    var index;\n    var nodes = metaTag(doc, \"og:video\", \"property\") || metaTag(doc, \"og:video\", \"name\");\n    if (nodes === null || nodes === void 0 ? void 0 : nodes.length) {\n        nodeTypes =\n            metaTag(doc, \"og:video:type\", \"property\") ||\n                metaTag(doc, \"og:video:type\", \"name\");\n        nodeSecureUrls =\n            metaTag(doc, \"og:video:secure_url\", \"property\") ||\n                metaTag(doc, \"og:video:secure_url\", \"name\");\n        width =\n            metaTagContent(doc, \"og:video:width\", \"property\") ||\n                metaTagContent(doc, \"og:video:width\", \"name\");\n        height =\n            metaTagContent(doc, \"og:video:height\", \"property\") ||\n                metaTagContent(doc, \"og:video:height\", \"name\");\n        for (index = 0; index < nodes.length; index += 1) {\n            var node = nodes[index];\n            if (node.type === \"tag\")\n                video = node.attribs.content;\n            nodeType = nodeTypes === null || nodeTypes === void 0 ? void 0 : nodeTypes[index];\n            if ((nodeType === null || nodeType === void 0 ? void 0 : nodeType.type) === \"tag\") {\n                videoType = nodeType ? nodeType.attribs.content : null;\n            }\n            nodeSecureUrl = nodeSecureUrls === null || nodeSecureUrls === void 0 ? void 0 : nodeSecureUrls[index];\n            if ((nodeSecureUrl === null || nodeSecureUrl === void 0 ? void 0 : nodeSecureUrl.type) === \"tag\") {\n                videoSecureUrl = nodeSecureUrl ? nodeSecureUrl.attribs.content : null;\n            }\n            videoObj = {\n                url: video,\n                secureUrl: videoSecureUrl,\n                type: videoType,\n                width: width,\n                height: height,\n            };\n            if (videoType && videoType.indexOf(\"video/\") === 0) {\n                videos.splice(0, 0, videoObj);\n            }\n            else {\n                videos.push(videoObj);\n            }\n        }\n    }\n    return videos;\n}\n// returns default favicon (//hostname/favicon.ico) for a url\nfunction getDefaultFavicon(rootUrl) {\n    return url_1.default.resolve(rootUrl, \"/favicon.ico\");\n}\n// returns an array of URLs to favicon images\nfunction getFavicons(doc, rootUrl) {\n    var images = [];\n    var nodes = [];\n    var src;\n    var relSelectors = [\n        \"rel=icon\",\n        \"rel=\\\"shortcut icon\\\"\",\n        \"rel=apple-touch-icon\",\n    ];\n    relSelectors.forEach(function (relSelector) {\n        // look for all icon tags\n        nodes = doc(\"link[\".concat(relSelector, \"]\"));\n        // collect all images from icon tags\n        if (nodes.length) {\n            nodes.each(function (_, node) {\n                if (node.type === \"tag\")\n                    src = node.attribs.href;\n                if (src) {\n                    src = url_1.default.resolve(rootUrl, src);\n                    images.push(src);\n                }\n            });\n        }\n    });\n    // if no icon images, use default favicon location\n    if (images.length <= 0) {\n        images.push(getDefaultFavicon(rootUrl));\n    }\n    return images;\n}\nfunction parseImageResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"image\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseAudioResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"audio\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseVideoResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"video\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseApplicationResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"application\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseTextResponse(body, url, options, contentType) {\n    if (options === void 0) { options = {}; }\n    var doc = cheerio_1.default.load(body);\n    return {\n        url: url,\n        title: getTitle(doc),\n        siteName: getSiteName(doc),\n        description: getDescription(doc),\n        mediaType: getMediaType(doc) || \"website\",\n        contentType: contentType,\n        images: getImages(doc, url, options.imagesPropertyType),\n        videos: getVideos(doc),\n        favicons: getFavicons(doc, url),\n    };\n}\nfunction parseUnknownResponse(body, url, options, contentType) {\n    if (options === void 0) { options = {}; }\n    return parseTextResponse(body, url, options, contentType);\n}\nfunction parseResponse(response, options) {\n    try {\n        // console.log(\"[link-preview-js] response\", response);\n        var contentType = response.headers[\"content-type\"];\n        var contentTypeTokens = [];\n        var charset = null;\n        if (!contentType) {\n            return parseUnknownResponse(response.data, response.url, options);\n        }\n        if (contentType.includes(\";\")) {\n            contentTypeTokens = contentType.split(\";\");\n            contentType = contentTypeTokens[0];\n            for (var _i = 0, contentTypeTokens_1 = contentTypeTokens; _i < contentTypeTokens_1.length; _i++) {\n                var token = contentTypeTokens_1[_i];\n                if (token.indexOf(\"charset=\") !== -1) {\n                    charset = token.split(\"=\")[1];\n                }\n            }\n        }\n        // parse response depending on content type\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_IMAGE.test(contentType)) {\n            return __assign(__assign({}, parseImageResponse(response.url, contentType)), { charset: charset });\n        }\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_AUDIO.test(contentType)) {\n            return __assign(__assign({}, parseAudioResponse(response.url, contentType)), { charset: charset });\n        }\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_VIDEO.test(contentType)) {\n            return __assign(__assign({}, parseVideoResponse(response.url, contentType)), { charset: charset });\n        }\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_TEXT.test(contentType)) {\n            var htmlString_1 = response.data;\n            return __assign(__assign({}, parseTextResponse(htmlString_1, response.url, options, contentType)), { charset: charset });\n        }\n        if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_APPLICATION.test(contentType)) {\n            return __assign(__assign({}, parseApplicationResponse(response.url, contentType)), { charset: charset });\n        }\n        var htmlString = response.data;\n        return __assign(__assign({}, parseUnknownResponse(htmlString, response.url, options)), { charset: charset });\n    }\n    catch (e) {\n        throw new Error(\"link-preview-js could not fetch link information \".concat(e.toString()));\n    }\n}\n/**\n * Parses the text, extracts the first link it finds and does a HTTP request\n * to fetch the website content, afterwards it tries to parse the internal HTML\n * and extract the information via meta tags\n * @param text string, text to be parsed\n * @param options ILinkPreviewOptions\n */\nfunction getLinkPreview(text, options) {\n    var _a, _b, _c;\n    return __awaiter(this, void 0, void 0, function () {\n        var detectedUrl, resolvedUrl, timeout, controller, timeoutCounter, fetchOptions, fetchUrl, response, forwardedUrl, resolvedUrl, headers, normalizedResponse;\n        var _d;\n        return __generator(this, function (_e) {\n            switch (_e.label) {\n                case 0:\n                    if (!text || typeof text !== \"string\") {\n                        throw new Error(\"link-preview-js did not receive a valid url or text\");\n                    }\n                    detectedUrl = text\n                        .replace(/\\n/g, \" \")\n                        .split(\" \")\n                        .find(function (token) { return constants_1.CONSTANTS.REGEX_VALID_URL.test(token); });\n                    if (!detectedUrl) {\n                        throw new Error(\"link-preview-js did not receive a valid a url or text\");\n                    }\n                    if ((options === null || options === void 0 ? void 0 : options.followRedirects) === \"manual\" && !(options === null || options === void 0 ? void 0 : options.handleRedirects)) {\n                        throw new Error(\"link-preview-js followRedirects is set to manual, but no handleRedirects function was provided\");\n                    }\n                    if (!!!(options === null || options === void 0 ? void 0 : options.resolveDNSHost)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, options.resolveDNSHost(detectedUrl)];\n                case 1:\n                    resolvedUrl = _e.sent();\n                    throwOnLoopback(resolvedUrl);\n                    _e.label = 2;\n                case 2:\n                    timeout = (_a = options === null || options === void 0 ? void 0 : options.timeout) !== null && _a !== void 0 ? _a : 3000;\n                    controller = createAbortController();\n                    timeoutCounter = setTimeout(function () { return controller.abort(); }, timeout);\n                    fetchOptions = {\n                        headers: (_b = options === null || options === void 0 ? void 0 : options.headers) !== null && _b !== void 0 ? _b : {},\n                        redirect: (_c = options === null || options === void 0 ? void 0 : options.followRedirects) !== null && _c !== void 0 ? _c : \"error\",\n                        signal: controller.signal,\n                    };\n                    fetchUrl = (options === null || options === void 0 ? void 0 : options.proxyUrl)\n                        ? options.proxyUrl.concat(detectedUrl)\n                        : detectedUrl;\n                    return [4 /*yield*/, (0, cross_fetch_1.fetch)(fetchUrl, fetchOptions).catch(function (e) {\n                            if (e.name === \"AbortError\") {\n                                throw new Error(\"Request timeout\");\n                            }\n                            clearTimeout(timeoutCounter);\n                            throw e;\n                        })];\n                case 3:\n                    response = _e.sent();\n                    if (!(response.status > 300 &&\n                        response.status < 309 &&\n                        fetchOptions.redirect === \"manual\" &&\n                        (options === null || options === void 0 ? void 0 : options.handleRedirects))) return [3 /*break*/, 7];\n                    forwardedUrl = response.headers.get(\"location\") || \"\";\n                    if (!options.handleRedirects(fetchUrl, forwardedUrl)) {\n                        throw new Error(\"link-preview-js could not handle redirect\");\n                    }\n                    if (!!!(options === null || options === void 0 ? void 0 : options.resolveDNSHost)) return [3 /*break*/, 5];\n                    return [4 /*yield*/, options.resolveDNSHost(forwardedUrl)];\n                case 4:\n                    resolvedUrl = _e.sent();\n                    throwOnLoopback(resolvedUrl);\n                    _e.label = 5;\n                case 5: return [4 /*yield*/, (0, cross_fetch_1.fetch)(forwardedUrl, fetchOptions)];\n                case 6:\n                    response = _e.sent();\n                    _e.label = 7;\n                case 7:\n                    clearTimeout(timeoutCounter);\n                    headers = {};\n                    response.headers.forEach(function (header, key) {\n                        headers[key] = header;\n                    });\n                    _d = {\n                        url: (options === null || options === void 0 ? void 0 : options.proxyUrl)\n                            ? response.url.replace(options.proxyUrl, \"\")\n                            : response.url,\n                        headers: headers\n                    };\n                    return [4 /*yield*/, response.text()];\n                case 8:\n                    normalizedResponse = (_d.data = _e.sent(),\n                        _d);\n                    return [2 /*return*/, parseResponse(normalizedResponse, options)];\n            }\n        });\n    });\n}\nexports.getLinkPreview = getLinkPreview;\n/**\n * Skip the library fetching the website for you, instead pass a response object\n * from whatever source you get and use the internal parsing of the HTML to return\n * the necessary information\n * @param response Preview Response\n * @param options IPreviewLinkOptions\n */\nfunction getPreviewFromContent(response, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            if (!response || typeof response !== \"object\") {\n                throw new Error(\"link-preview-js did not receive a valid response object\");\n            }\n            if (!response.url) {\n                throw new Error(\"link-preview-js did not receive a valid response object\");\n            }\n            return [2 /*return*/, parseResponse(response, options)];\n        });\n    });\n}\nexports.getPreviewFromContent = getPreviewFromContent;\nfunction createAbortController() {\n    return typeof AbortController == 'undefined'\n        ? new abort_controller_1.default()\n        : new AbortController();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9saW5rLXByZXZpZXctanMvYnVpbGQvaW5kZXguanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYjtBQUNBO0FBQ0EsaURBQWlELE9BQU87QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLGNBQWMsNkJBQTZCLDBCQUEwQixjQUFjLHFCQUFxQjtBQUN4RyxpQkFBaUIsb0RBQW9ELHFFQUFxRSxjQUFjO0FBQ3hKLHVCQUF1QixzQkFBc0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDLG1DQUFtQyxTQUFTO0FBQzVDLG1DQUFtQyxXQUFXLFVBQVU7QUFDeEQsMENBQTBDLGNBQWM7QUFDeEQ7QUFDQSw4R0FBOEcsT0FBTztBQUNySCxpRkFBaUYsaUJBQWlCO0FBQ2xHLHlEQUF5RCxnQkFBZ0IsUUFBUTtBQUNqRiwrQ0FBK0MsZ0JBQWdCLGdCQUFnQjtBQUMvRTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0EsVUFBVSxZQUFZLGFBQWEsU0FBUyxVQUFVO0FBQ3RELG9DQUFvQyxTQUFTO0FBQzdDO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw2QkFBNkIsR0FBRyxzQkFBc0I7QUFDdEQsZ0NBQWdDLG1CQUFPLENBQUMscUVBQVM7QUFDakQsb0JBQW9CLG1CQUFPLENBQUMsc0ZBQWE7QUFDekMseUNBQXlDLG1CQUFPLENBQUMsbUdBQWtCO0FBQ25FLDRCQUE0QixtQkFBTyxDQUFDLGdCQUFLO0FBQ3pDLGtCQUFrQixtQkFBTyxDQUFDLHVGQUFhO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHNCQUFzQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQztBQUNuQyxvREFBb0Q7QUFDcEQ7QUFDQSxzRUFBc0UsaUNBQWlDO0FBQ3ZHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsb0RBQW9ELGtCQUFrQjtBQUM3RztBQUNBO0FBQ0EsdUNBQXVDLG9EQUFvRCxrQkFBa0I7QUFDN0c7QUFDQTtBQUNBLHVDQUF1QyxvREFBb0Qsa0JBQWtCO0FBQzdHO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QywwRUFBMEUsa0JBQWtCO0FBQ25JO0FBQ0E7QUFDQSx1Q0FBdUMsMERBQTBELGtCQUFrQjtBQUNuSDtBQUNBO0FBQ0EsbUNBQW1DLDhEQUE4RCxrQkFBa0I7QUFDbkg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCwyREFBMkQ7QUFDNUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOERBQThELDRCQUE0QjtBQUMxRjtBQUNBLDZJQUE2STtBQUM3STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvbW50L2MvVXNlcnMvdGFuYWgvZ2l0L0phdmFMYW5nUnVudGltZUV4Y2VwdGlvbi5naXRodWIuaW8vbm9kZV9tb2R1bGVzL2xpbmstcHJldmlldy1qcy9idWlsZC9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXG4gICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgfTtcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcbiAgICB9XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRQcmV2aWV3RnJvbUNvbnRlbnQgPSBleHBvcnRzLmdldExpbmtQcmV2aWV3ID0gdm9pZCAwO1xudmFyIGNoZWVyaW9fMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiY2hlZXJpb1wiKSk7XG52YXIgY3Jvc3NfZmV0Y2hfMSA9IHJlcXVpcmUoXCJjcm9zcy1mZXRjaFwiKTtcbnZhciBhYm9ydF9jb250cm9sbGVyXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImFib3J0LWNvbnRyb2xsZXJcIikpO1xudmFyIHVybF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJ1cmxcIikpO1xudmFyIGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzXCIpO1xuZnVuY3Rpb24gdGhyb3dPbkxvb3BiYWNrKGFkZHJlc3MpIHtcbiAgICBpZiAoY29uc3RhbnRzXzEuQ09OU1RBTlRTLlJFR0VYX0xPT1BCQUNLLnRlc3QoYWRkcmVzcykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU1NSRiByZXF1ZXN0IGRldGVjdGVkLCB0cnlpbmcgdG8gcXVlcnkgaG9zdFwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiBtZXRhVGFnKGRvYywgdHlwZSwgYXR0cikge1xuICAgIHZhciBub2RlcyA9IGRvYyhcIm1ldGFbXCIuY29uY2F0KGF0dHIsIFwiPSdcIikuY29uY2F0KHR5cGUsIFwiJ11cIikpO1xuICAgIHJldHVybiBub2Rlcy5sZW5ndGggPyBub2RlcyA6IG51bGw7XG59XG5mdW5jdGlvbiBtZXRhVGFnQ29udGVudChkb2MsIHR5cGUsIGF0dHIpIHtcbiAgICByZXR1cm4gZG9jKFwibWV0YVtcIi5jb25jYXQoYXR0ciwgXCI9J1wiKS5jb25jYXQodHlwZSwgXCInXVwiKSkuYXR0cihcImNvbnRlbnRcIik7XG59XG5mdW5jdGlvbiBnZXRUaXRsZShkb2MpIHtcbiAgICB2YXIgdGl0bGUgPSBtZXRhVGFnQ29udGVudChkb2MsIFwib2c6dGl0bGVcIiwgXCJwcm9wZXJ0eVwiKSB8fFxuICAgICAgICBtZXRhVGFnQ29udGVudChkb2MsIFwib2c6dGl0bGVcIiwgXCJuYW1lXCIpO1xuICAgIGlmICghdGl0bGUpIHtcbiAgICAgICAgdGl0bGUgPSBkb2MoXCJoZWFkID4gdGl0bGVcIikudGV4dCgpO1xuICAgIH1cbiAgICByZXR1cm4gdGl0bGU7XG59XG5mdW5jdGlvbiBnZXRTaXRlTmFtZShkb2MpIHtcbiAgICB2YXIgc2l0ZU5hbWUgPSBtZXRhVGFnQ29udGVudChkb2MsIFwib2c6c2l0ZV9uYW1lXCIsIFwicHJvcGVydHlcIikgfHxcbiAgICAgICAgbWV0YVRhZ0NvbnRlbnQoZG9jLCBcIm9nOnNpdGVfbmFtZVwiLCBcIm5hbWVcIik7XG4gICAgcmV0dXJuIHNpdGVOYW1lO1xufVxuZnVuY3Rpb24gZ2V0RGVzY3JpcHRpb24oZG9jKSB7XG4gICAgdmFyIGRlc2NyaXB0aW9uID0gbWV0YVRhZ0NvbnRlbnQoZG9jLCBcImRlc2NyaXB0aW9uXCIsIFwibmFtZVwiKSB8fFxuICAgICAgICBtZXRhVGFnQ29udGVudChkb2MsIFwiRGVzY3JpcHRpb25cIiwgXCJuYW1lXCIpIHx8XG4gICAgICAgIG1ldGFUYWdDb250ZW50KGRvYywgXCJvZzpkZXNjcmlwdGlvblwiLCBcInByb3BlcnR5XCIpO1xuICAgIHJldHVybiBkZXNjcmlwdGlvbjtcbn1cbmZ1bmN0aW9uIGdldE1lZGlhVHlwZShkb2MpIHtcbiAgICB2YXIgbm9kZSA9IG1ldGFUYWcoZG9jLCBcIm1lZGl1bVwiLCBcIm5hbWVcIik7XG4gICAgaWYgKG5vZGUpIHtcbiAgICAgICAgdmFyIGNvbnRlbnQgPSBub2RlLmF0dHIoXCJjb250ZW50XCIpO1xuICAgICAgICByZXR1cm4gY29udGVudCA9PT0gXCJpbWFnZVwiID8gXCJwaG90b1wiIDogY29udGVudDtcbiAgICB9XG4gICAgcmV0dXJuIChtZXRhVGFnQ29udGVudChkb2MsIFwib2c6dHlwZVwiLCBcInByb3BlcnR5XCIpIHx8XG4gICAgICAgIG1ldGFUYWdDb250ZW50KGRvYywgXCJvZzp0eXBlXCIsIFwibmFtZVwiKSk7XG59XG5mdW5jdGlvbiBnZXRJbWFnZXMoZG9jLCByb290VXJsLCBpbWFnZXNQcm9wZXJ0eVR5cGUpIHtcbiAgICB2YXIgaW1hZ2VzID0gW107XG4gICAgdmFyIG5vZGVzO1xuICAgIHZhciBzcmM7XG4gICAgdmFyIGRpYyA9IHt9O1xuICAgIHZhciBpbWFnZVByb3BlcnR5VHlwZSA9IGltYWdlc1Byb3BlcnR5VHlwZSAhPT0gbnVsbCAmJiBpbWFnZXNQcm9wZXJ0eVR5cGUgIT09IHZvaWQgMCA/IGltYWdlc1Byb3BlcnR5VHlwZSA6IFwib2dcIjtcbiAgICBub2RlcyA9XG4gICAgICAgIG1ldGFUYWcoZG9jLCBcIlwiLmNvbmNhdChpbWFnZVByb3BlcnR5VHlwZSwgXCI6aW1hZ2VcIiksIFwicHJvcGVydHlcIikgfHxcbiAgICAgICAgICAgIG1ldGFUYWcoZG9jLCBcIlwiLmNvbmNhdChpbWFnZVByb3BlcnR5VHlwZSwgXCI6aW1hZ2VcIiksIFwibmFtZVwiKTtcbiAgICBpZiAobm9kZXMpIHtcbiAgICAgICAgbm9kZXMuZWFjaChmdW5jdGlvbiAoXywgbm9kZSkge1xuICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gXCJ0YWdcIikge1xuICAgICAgICAgICAgICAgIHNyYyA9IG5vZGUuYXR0cmlicy5jb250ZW50O1xuICAgICAgICAgICAgICAgIGlmIChzcmMpIHtcbiAgICAgICAgICAgICAgICAgICAgc3JjID0gdXJsXzEuZGVmYXVsdC5yZXNvbHZlKHJvb3RVcmwsIHNyYyk7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlcy5wdXNoKHNyYyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGltYWdlcy5sZW5ndGggPD0gMCAmJiAhaW1hZ2VzUHJvcGVydHlUeXBlKSB7XG4gICAgICAgIHNyYyA9IGRvYyhcImxpbmtbcmVsPWltYWdlX3NyY11cIikuYXR0cihcImhyZWZcIik7XG4gICAgICAgIGlmIChzcmMpIHtcbiAgICAgICAgICAgIHNyYyA9IHVybF8xLmRlZmF1bHQucmVzb2x2ZShyb290VXJsLCBzcmMpO1xuICAgICAgICAgICAgaW1hZ2VzID0gW3NyY107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBub2RlcyA9IGRvYyhcImltZ1wiKTtcbiAgICAgICAgICAgIGlmIChub2RlcyA9PT0gbnVsbCB8fCBub2RlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZGljID0ge307XG4gICAgICAgICAgICAgICAgaW1hZ2VzID0gW107XG4gICAgICAgICAgICAgICAgbm9kZXMuZWFjaChmdW5jdGlvbiAoXywgbm9kZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSBcInRhZ1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgc3JjID0gbm9kZS5hdHRyaWJzLnNyYztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNyYyAmJiAhZGljW3NyY10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpY1tzcmNdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpZHRoID0gbm9kZS5hdHRyaWJzLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGVpZ2h0ID0gbm9kZS5hdHRyaWJzLmhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlcy5wdXNoKHVybF8xLmRlZmF1bHQucmVzb2x2ZShyb290VXJsLCBzcmMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpbWFnZXM7XG59XG5mdW5jdGlvbiBnZXRWaWRlb3MoZG9jKSB7XG4gICAgdmFyIHZpZGVvcyA9IFtdO1xuICAgIHZhciBub2RlVHlwZXM7XG4gICAgdmFyIG5vZGVTZWN1cmVVcmxzO1xuICAgIHZhciBub2RlVHlwZTtcbiAgICB2YXIgbm9kZVNlY3VyZVVybDtcbiAgICB2YXIgdmlkZW87XG4gICAgdmFyIHZpZGVvVHlwZTtcbiAgICB2YXIgdmlkZW9TZWN1cmVVcmw7XG4gICAgdmFyIHdpZHRoO1xuICAgIHZhciBoZWlnaHQ7XG4gICAgdmFyIHZpZGVvT2JqO1xuICAgIHZhciBpbmRleDtcbiAgICB2YXIgbm9kZXMgPSBtZXRhVGFnKGRvYywgXCJvZzp2aWRlb1wiLCBcInByb3BlcnR5XCIpIHx8IG1ldGFUYWcoZG9jLCBcIm9nOnZpZGVvXCIsIFwibmFtZVwiKTtcbiAgICBpZiAobm9kZXMgPT09IG51bGwgfHwgbm9kZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5vZGVzLmxlbmd0aCkge1xuICAgICAgICBub2RlVHlwZXMgPVxuICAgICAgICAgICAgbWV0YVRhZyhkb2MsIFwib2c6dmlkZW86dHlwZVwiLCBcInByb3BlcnR5XCIpIHx8XG4gICAgICAgICAgICAgICAgbWV0YVRhZyhkb2MsIFwib2c6dmlkZW86dHlwZVwiLCBcIm5hbWVcIik7XG4gICAgICAgIG5vZGVTZWN1cmVVcmxzID1cbiAgICAgICAgICAgIG1ldGFUYWcoZG9jLCBcIm9nOnZpZGVvOnNlY3VyZV91cmxcIiwgXCJwcm9wZXJ0eVwiKSB8fFxuICAgICAgICAgICAgICAgIG1ldGFUYWcoZG9jLCBcIm9nOnZpZGVvOnNlY3VyZV91cmxcIiwgXCJuYW1lXCIpO1xuICAgICAgICB3aWR0aCA9XG4gICAgICAgICAgICBtZXRhVGFnQ29udGVudChkb2MsIFwib2c6dmlkZW86d2lkdGhcIiwgXCJwcm9wZXJ0eVwiKSB8fFxuICAgICAgICAgICAgICAgIG1ldGFUYWdDb250ZW50KGRvYywgXCJvZzp2aWRlbzp3aWR0aFwiLCBcIm5hbWVcIik7XG4gICAgICAgIGhlaWdodCA9XG4gICAgICAgICAgICBtZXRhVGFnQ29udGVudChkb2MsIFwib2c6dmlkZW86aGVpZ2h0XCIsIFwicHJvcGVydHlcIikgfHxcbiAgICAgICAgICAgICAgICBtZXRhVGFnQ29udGVudChkb2MsIFwib2c6dmlkZW86aGVpZ2h0XCIsIFwibmFtZVwiKTtcbiAgICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgbm9kZXMubGVuZ3RoOyBpbmRleCArPSAxKSB7XG4gICAgICAgICAgICB2YXIgbm9kZSA9IG5vZGVzW2luZGV4XTtcbiAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09IFwidGFnXCIpXG4gICAgICAgICAgICAgICAgdmlkZW8gPSBub2RlLmF0dHJpYnMuY29udGVudDtcbiAgICAgICAgICAgIG5vZGVUeXBlID0gbm9kZVR5cGVzID09PSBudWxsIHx8IG5vZGVUeXBlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZVR5cGVzW2luZGV4XTtcbiAgICAgICAgICAgIGlmICgobm9kZVR5cGUgPT09IG51bGwgfHwgbm9kZVR5cGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5vZGVUeXBlLnR5cGUpID09PSBcInRhZ1wiKSB7XG4gICAgICAgICAgICAgICAgdmlkZW9UeXBlID0gbm9kZVR5cGUgPyBub2RlVHlwZS5hdHRyaWJzLmNvbnRlbnQgOiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9kZVNlY3VyZVVybCA9IG5vZGVTZWN1cmVVcmxzID09PSBudWxsIHx8IG5vZGVTZWN1cmVVcmxzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBub2RlU2VjdXJlVXJsc1tpbmRleF07XG4gICAgICAgICAgICBpZiAoKG5vZGVTZWN1cmVVcmwgPT09IG51bGwgfHwgbm9kZVNlY3VyZVVybCA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZVNlY3VyZVVybC50eXBlKSA9PT0gXCJ0YWdcIikge1xuICAgICAgICAgICAgICAgIHZpZGVvU2VjdXJlVXJsID0gbm9kZVNlY3VyZVVybCA/IG5vZGVTZWN1cmVVcmwuYXR0cmlicy5jb250ZW50IDogbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZpZGVvT2JqID0ge1xuICAgICAgICAgICAgICAgIHVybDogdmlkZW8sXG4gICAgICAgICAgICAgICAgc2VjdXJlVXJsOiB2aWRlb1NlY3VyZVVybCxcbiAgICAgICAgICAgICAgICB0eXBlOiB2aWRlb1R5cGUsXG4gICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICh2aWRlb1R5cGUgJiYgdmlkZW9UeXBlLmluZGV4T2YoXCJ2aWRlby9cIikgPT09IDApIHtcbiAgICAgICAgICAgICAgICB2aWRlb3Muc3BsaWNlKDAsIDAsIHZpZGVvT2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZpZGVvcy5wdXNoKHZpZGVvT2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmlkZW9zO1xufVxuLy8gcmV0dXJucyBkZWZhdWx0IGZhdmljb24gKC8vaG9zdG5hbWUvZmF2aWNvbi5pY28pIGZvciBhIHVybFxuZnVuY3Rpb24gZ2V0RGVmYXVsdEZhdmljb24ocm9vdFVybCkge1xuICAgIHJldHVybiB1cmxfMS5kZWZhdWx0LnJlc29sdmUocm9vdFVybCwgXCIvZmF2aWNvbi5pY29cIik7XG59XG4vLyByZXR1cm5zIGFuIGFycmF5IG9mIFVSTHMgdG8gZmF2aWNvbiBpbWFnZXNcbmZ1bmN0aW9uIGdldEZhdmljb25zKGRvYywgcm9vdFVybCkge1xuICAgIHZhciBpbWFnZXMgPSBbXTtcbiAgICB2YXIgbm9kZXMgPSBbXTtcbiAgICB2YXIgc3JjO1xuICAgIHZhciByZWxTZWxlY3RvcnMgPSBbXG4gICAgICAgIFwicmVsPWljb25cIixcbiAgICAgICAgXCJyZWw9XFxcInNob3J0Y3V0IGljb25cXFwiXCIsXG4gICAgICAgIFwicmVsPWFwcGxlLXRvdWNoLWljb25cIixcbiAgICBdO1xuICAgIHJlbFNlbGVjdG9ycy5mb3JFYWNoKGZ1bmN0aW9uIChyZWxTZWxlY3Rvcikge1xuICAgICAgICAvLyBsb29rIGZvciBhbGwgaWNvbiB0YWdzXG4gICAgICAgIG5vZGVzID0gZG9jKFwibGlua1tcIi5jb25jYXQocmVsU2VsZWN0b3IsIFwiXVwiKSk7XG4gICAgICAgIC8vIGNvbGxlY3QgYWxsIGltYWdlcyBmcm9tIGljb24gdGFnc1xuICAgICAgICBpZiAobm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBub2Rlcy5lYWNoKGZ1bmN0aW9uIChfLCBub2RlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gXCJ0YWdcIilcbiAgICAgICAgICAgICAgICAgICAgc3JjID0gbm9kZS5hdHRyaWJzLmhyZWY7XG4gICAgICAgICAgICAgICAgaWYgKHNyYykge1xuICAgICAgICAgICAgICAgICAgICBzcmMgPSB1cmxfMS5kZWZhdWx0LnJlc29sdmUocm9vdFVybCwgc3JjKTtcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VzLnB1c2goc3JjKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGlmIG5vIGljb24gaW1hZ2VzLCB1c2UgZGVmYXVsdCBmYXZpY29uIGxvY2F0aW9uXG4gICAgaWYgKGltYWdlcy5sZW5ndGggPD0gMCkge1xuICAgICAgICBpbWFnZXMucHVzaChnZXREZWZhdWx0RmF2aWNvbihyb290VXJsKSk7XG4gICAgfVxuICAgIHJldHVybiBpbWFnZXM7XG59XG5mdW5jdGlvbiBwYXJzZUltYWdlUmVzcG9uc2UodXJsLCBjb250ZW50VHlwZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHVybDogdXJsLFxuICAgICAgICBtZWRpYVR5cGU6IFwiaW1hZ2VcIixcbiAgICAgICAgY29udGVudFR5cGU6IGNvbnRlbnRUeXBlLFxuICAgICAgICBmYXZpY29uczogW2dldERlZmF1bHRGYXZpY29uKHVybCldLFxuICAgIH07XG59XG5mdW5jdGlvbiBwYXJzZUF1ZGlvUmVzcG9uc2UodXJsLCBjb250ZW50VHlwZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHVybDogdXJsLFxuICAgICAgICBtZWRpYVR5cGU6IFwiYXVkaW9cIixcbiAgICAgICAgY29udGVudFR5cGU6IGNvbnRlbnRUeXBlLFxuICAgICAgICBmYXZpY29uczogW2dldERlZmF1bHRGYXZpY29uKHVybCldLFxuICAgIH07XG59XG5mdW5jdGlvbiBwYXJzZVZpZGVvUmVzcG9uc2UodXJsLCBjb250ZW50VHlwZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHVybDogdXJsLFxuICAgICAgICBtZWRpYVR5cGU6IFwidmlkZW9cIixcbiAgICAgICAgY29udGVudFR5cGU6IGNvbnRlbnRUeXBlLFxuICAgICAgICBmYXZpY29uczogW2dldERlZmF1bHRGYXZpY29uKHVybCldLFxuICAgIH07XG59XG5mdW5jdGlvbiBwYXJzZUFwcGxpY2F0aW9uUmVzcG9uc2UodXJsLCBjb250ZW50VHlwZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHVybDogdXJsLFxuICAgICAgICBtZWRpYVR5cGU6IFwiYXBwbGljYXRpb25cIixcbiAgICAgICAgY29udGVudFR5cGU6IGNvbnRlbnRUeXBlLFxuICAgICAgICBmYXZpY29uczogW2dldERlZmF1bHRGYXZpY29uKHVybCldLFxuICAgIH07XG59XG5mdW5jdGlvbiBwYXJzZVRleHRSZXNwb25zZShib2R5LCB1cmwsIG9wdGlvbnMsIGNvbnRlbnRUeXBlKSB7XG4gICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cbiAgICB2YXIgZG9jID0gY2hlZXJpb18xLmRlZmF1bHQubG9hZChib2R5KTtcbiAgICByZXR1cm4ge1xuICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgdGl0bGU6IGdldFRpdGxlKGRvYyksXG4gICAgICAgIHNpdGVOYW1lOiBnZXRTaXRlTmFtZShkb2MpLFxuICAgICAgICBkZXNjcmlwdGlvbjogZ2V0RGVzY3JpcHRpb24oZG9jKSxcbiAgICAgICAgbWVkaWFUeXBlOiBnZXRNZWRpYVR5cGUoZG9jKSB8fCBcIndlYnNpdGVcIixcbiAgICAgICAgY29udGVudFR5cGU6IGNvbnRlbnRUeXBlLFxuICAgICAgICBpbWFnZXM6IGdldEltYWdlcyhkb2MsIHVybCwgb3B0aW9ucy5pbWFnZXNQcm9wZXJ0eVR5cGUpLFxuICAgICAgICB2aWRlb3M6IGdldFZpZGVvcyhkb2MpLFxuICAgICAgICBmYXZpY29uczogZ2V0RmF2aWNvbnMoZG9jLCB1cmwpLFxuICAgIH07XG59XG5mdW5jdGlvbiBwYXJzZVVua25vd25SZXNwb25zZShib2R5LCB1cmwsIG9wdGlvbnMsIGNvbnRlbnRUeXBlKSB7XG4gICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cbiAgICByZXR1cm4gcGFyc2VUZXh0UmVzcG9uc2UoYm9keSwgdXJsLCBvcHRpb25zLCBjb250ZW50VHlwZSk7XG59XG5mdW5jdGlvbiBwYXJzZVJlc3BvbnNlKHJlc3BvbnNlLCBvcHRpb25zKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJbbGluay1wcmV2aWV3LWpzXSByZXNwb25zZVwiLCByZXNwb25zZSk7XG4gICAgICAgIHZhciBjb250ZW50VHlwZSA9IHJlc3BvbnNlLmhlYWRlcnNbXCJjb250ZW50LXR5cGVcIl07XG4gICAgICAgIHZhciBjb250ZW50VHlwZVRva2VucyA9IFtdO1xuICAgICAgICB2YXIgY2hhcnNldCA9IG51bGw7XG4gICAgICAgIGlmICghY29udGVudFR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZVVua25vd25SZXNwb25zZShyZXNwb25zZS5kYXRhLCByZXNwb25zZS51cmwsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZW50VHlwZS5pbmNsdWRlcyhcIjtcIikpIHtcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlVG9rZW5zID0gY29udGVudFR5cGUuc3BsaXQoXCI7XCIpO1xuICAgICAgICAgICAgY29udGVudFR5cGUgPSBjb250ZW50VHlwZVRva2Vuc1swXTtcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgY29udGVudFR5cGVUb2tlbnNfMSA9IGNvbnRlbnRUeXBlVG9rZW5zOyBfaSA8IGNvbnRlbnRUeXBlVG9rZW5zXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRva2VuID0gY29udGVudFR5cGVUb2tlbnNfMVtfaV07XG4gICAgICAgICAgICAgICAgaWYgKHRva2VuLmluZGV4T2YoXCJjaGFyc2V0PVwiKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhcnNldCA9IHRva2VuLnNwbGl0KFwiPVwiKVsxXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gcGFyc2UgcmVzcG9uc2UgZGVwZW5kaW5nIG9uIGNvbnRlbnQgdHlwZVxuICAgICAgICBpZiAoY29uc3RhbnRzXzEuQ09OU1RBTlRTLlJFR0VYX0NPTlRFTlRfVFlQRV9JTUFHRS50ZXN0KGNvbnRlbnRUeXBlKSkge1xuICAgICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBwYXJzZUltYWdlUmVzcG9uc2UocmVzcG9uc2UudXJsLCBjb250ZW50VHlwZSkpLCB7IGNoYXJzZXQ6IGNoYXJzZXQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnN0YW50c18xLkNPTlNUQU5UUy5SRUdFWF9DT05URU5UX1RZUEVfQVVESU8udGVzdChjb250ZW50VHlwZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgcGFyc2VBdWRpb1Jlc3BvbnNlKHJlc3BvbnNlLnVybCwgY29udGVudFR5cGUpKSwgeyBjaGFyc2V0OiBjaGFyc2V0IH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25zdGFudHNfMS5DT05TVEFOVFMuUkVHRVhfQ09OVEVOVF9UWVBFX1ZJREVPLnRlc3QoY29udGVudFR5cGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIHBhcnNlVmlkZW9SZXNwb25zZShyZXNwb25zZS51cmwsIGNvbnRlbnRUeXBlKSksIHsgY2hhcnNldDogY2hhcnNldCB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uc3RhbnRzXzEuQ09OU1RBTlRTLlJFR0VYX0NPTlRFTlRfVFlQRV9URVhULnRlc3QoY29udGVudFR5cGUpKSB7XG4gICAgICAgICAgICB2YXIgaHRtbFN0cmluZ18xID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgcGFyc2VUZXh0UmVzcG9uc2UoaHRtbFN0cmluZ18xLCByZXNwb25zZS51cmwsIG9wdGlvbnMsIGNvbnRlbnRUeXBlKSksIHsgY2hhcnNldDogY2hhcnNldCB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uc3RhbnRzXzEuQ09OU1RBTlRTLlJFR0VYX0NPTlRFTlRfVFlQRV9BUFBMSUNBVElPTi50ZXN0KGNvbnRlbnRUeXBlKSkge1xuICAgICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBwYXJzZUFwcGxpY2F0aW9uUmVzcG9uc2UocmVzcG9uc2UudXJsLCBjb250ZW50VHlwZSkpLCB7IGNoYXJzZXQ6IGNoYXJzZXQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGh0bWxTdHJpbmcgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIHBhcnNlVW5rbm93blJlc3BvbnNlKGh0bWxTdHJpbmcsIHJlc3BvbnNlLnVybCwgb3B0aW9ucykpLCB7IGNoYXJzZXQ6IGNoYXJzZXQgfSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImxpbmstcHJldmlldy1qcyBjb3VsZCBub3QgZmV0Y2ggbGluayBpbmZvcm1hdGlvbiBcIi5jb25jYXQoZS50b1N0cmluZygpKSk7XG4gICAgfVxufVxuLyoqXG4gKiBQYXJzZXMgdGhlIHRleHQsIGV4dHJhY3RzIHRoZSBmaXJzdCBsaW5rIGl0IGZpbmRzIGFuZCBkb2VzIGEgSFRUUCByZXF1ZXN0XG4gKiB0byBmZXRjaCB0aGUgd2Vic2l0ZSBjb250ZW50LCBhZnRlcndhcmRzIGl0IHRyaWVzIHRvIHBhcnNlIHRoZSBpbnRlcm5hbCBIVE1MXG4gKiBhbmQgZXh0cmFjdCB0aGUgaW5mb3JtYXRpb24gdmlhIG1ldGEgdGFnc1xuICogQHBhcmFtIHRleHQgc3RyaW5nLCB0ZXh0IHRvIGJlIHBhcnNlZFxuICogQHBhcmFtIG9wdGlvbnMgSUxpbmtQcmV2aWV3T3B0aW9uc1xuICovXG5mdW5jdGlvbiBnZXRMaW5rUHJldmlldyh0ZXh0LCBvcHRpb25zKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGV0ZWN0ZWRVcmwsIHJlc29sdmVkVXJsLCB0aW1lb3V0LCBjb250cm9sbGVyLCB0aW1lb3V0Q291bnRlciwgZmV0Y2hPcHRpb25zLCBmZXRjaFVybCwgcmVzcG9uc2UsIGZvcndhcmRlZFVybCwgcmVzb2x2ZWRVcmwsIGhlYWRlcnMsIG5vcm1hbGl6ZWRSZXNwb25zZTtcbiAgICAgICAgdmFyIF9kO1xuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9lKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKF9lLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRleHQgfHwgdHlwZW9mIHRleHQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImxpbmstcHJldmlldy1qcyBkaWQgbm90IHJlY2VpdmUgYSB2YWxpZCB1cmwgb3IgdGV4dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZFVybCA9IHRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXG4vZywgXCIgXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoXCIgXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmluZChmdW5jdGlvbiAodG9rZW4pIHsgcmV0dXJuIGNvbnN0YW50c18xLkNPTlNUQU5UUy5SRUdFWF9WQUxJRF9VUkwudGVzdCh0b2tlbik7IH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWRldGVjdGVkVXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJsaW5rLXByZXZpZXctanMgZGlkIG5vdCByZWNlaXZlIGEgdmFsaWQgYSB1cmwgb3IgdGV4dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoKG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5mb2xsb3dSZWRpcmVjdHMpID09PSBcIm1hbnVhbFwiICYmICEob3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmhhbmRsZVJlZGlyZWN0cykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImxpbmstcHJldmlldy1qcyBmb2xsb3dSZWRpcmVjdHMgaXMgc2V0IHRvIG1hbnVhbCwgYnV0IG5vIGhhbmRsZVJlZGlyZWN0cyBmdW5jdGlvbiB3YXMgcHJvdmlkZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCEhIShvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucmVzb2x2ZUROU0hvc3QpKSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgb3B0aW9ucy5yZXNvbHZlRE5TSG9zdChkZXRlY3RlZFVybCldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWRVcmwgPSBfZS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93T25Mb29wYmFjayhyZXNvbHZlZFVybCk7XG4gICAgICAgICAgICAgICAgICAgIF9lLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSAoX2EgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMudGltZW91dCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMzAwMDtcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlciA9IGNyZWF0ZUFib3J0Q29udHJvbGxlcigpO1xuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0Q291bnRlciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gY29udHJvbGxlci5hYm9ydCgpOyB9LCB0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgZmV0Y2hPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogKF9iID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmhlYWRlcnMpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3Q6IChfYyA9IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5mb2xsb3dSZWRpcmVjdHMpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IFwiZXJyb3JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbDogY29udHJvbGxlci5zaWduYWwsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGZldGNoVXJsID0gKG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5wcm94eVVybClcbiAgICAgICAgICAgICAgICAgICAgICAgID8gb3B0aW9ucy5wcm94eVVybC5jb25jYXQoZGV0ZWN0ZWRVcmwpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGRldGVjdGVkVXJsO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCAoMCwgY3Jvc3NfZmV0Y2hfMS5mZXRjaCkoZmV0Y2hVcmwsIGZldGNoT3B0aW9ucykuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5uYW1lID09PSBcIkFib3J0RXJyb3JcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSZXF1ZXN0IHRpbWVvdXRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0Q291bnRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2Uuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5zdGF0dXMgPiAzMDAgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyA8IDMwOSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hPcHRpb25zLnJlZGlyZWN0ID09PSBcIm1hbnVhbFwiICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAob3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmhhbmRsZVJlZGlyZWN0cykpKSByZXR1cm4gWzMgLypicmVhayovLCA3XTtcbiAgICAgICAgICAgICAgICAgICAgZm9yd2FyZGVkVXJsID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoXCJsb2NhdGlvblwiKSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuaGFuZGxlUmVkaXJlY3RzKGZldGNoVXJsLCBmb3J3YXJkZWRVcmwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJsaW5rLXByZXZpZXctanMgY291bGQgbm90IGhhbmRsZSByZWRpcmVjdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoISEhKG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5yZXNvbHZlRE5TSG9zdCkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDVdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBvcHRpb25zLnJlc29sdmVETlNIb3N0KGZvcndhcmRlZFVybCldO1xuICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWRVcmwgPSBfZS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93T25Mb29wYmFjayhyZXNvbHZlZFVybCk7XG4gICAgICAgICAgICAgICAgICAgIF9lLmxhYmVsID0gNTtcbiAgICAgICAgICAgICAgICBjYXNlIDU6IHJldHVybiBbNCAvKnlpZWxkKi8sICgwLCBjcm9zc19mZXRjaF8xLmZldGNoKShmb3J3YXJkZWRVcmwsIGZldGNoT3B0aW9ucyldO1xuICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfZS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIF9lLmxhYmVsID0gNztcbiAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0Q291bnRlcik7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuaGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoZWFkZXIsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1trZXldID0gaGVhZGVyO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgX2QgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IChvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMucHJveHlVcmwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyByZXNwb25zZS51cmwucmVwbGFjZShvcHRpb25zLnByb3h5VXJsLCBcIlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogcmVzcG9uc2UudXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCByZXNwb25zZS50ZXh0KCldO1xuICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZFJlc3BvbnNlID0gKF9kLmRhdGEgPSBfZS5zZW50KCksXG4gICAgICAgICAgICAgICAgICAgICAgICBfZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBwYXJzZVJlc3BvbnNlKG5vcm1hbGl6ZWRSZXNwb25zZSwgb3B0aW9ucyldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TGlua1ByZXZpZXcgPSBnZXRMaW5rUHJldmlldztcbi8qKlxuICogU2tpcCB0aGUgbGlicmFyeSBmZXRjaGluZyB0aGUgd2Vic2l0ZSBmb3IgeW91LCBpbnN0ZWFkIHBhc3MgYSByZXNwb25zZSBvYmplY3RcbiAqIGZyb20gd2hhdGV2ZXIgc291cmNlIHlvdSBnZXQgYW5kIHVzZSB0aGUgaW50ZXJuYWwgcGFyc2luZyBvZiB0aGUgSFRNTCB0byByZXR1cm5cbiAqIHRoZSBuZWNlc3NhcnkgaW5mb3JtYXRpb25cbiAqIEBwYXJhbSByZXNwb25zZSBQcmV2aWV3IFJlc3BvbnNlXG4gKiBAcGFyYW0gb3B0aW9ucyBJUHJldmlld0xpbmtPcHRpb25zXG4gKi9cbmZ1bmN0aW9uIGdldFByZXZpZXdGcm9tQ29udGVudChyZXNwb25zZSwgb3B0aW9ucykge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCB0eXBlb2YgcmVzcG9uc2UgIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJsaW5rLXByZXZpZXctanMgZGlkIG5vdCByZWNlaXZlIGEgdmFsaWQgcmVzcG9uc2Ugb2JqZWN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS51cmwpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJsaW5rLXByZXZpZXctanMgZGlkIG5vdCByZWNlaXZlIGEgdmFsaWQgcmVzcG9uc2Ugb2JqZWN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHBhcnNlUmVzcG9uc2UocmVzcG9uc2UsIG9wdGlvbnMpXTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFByZXZpZXdGcm9tQ29udGVudCA9IGdldFByZXZpZXdGcm9tQ29udGVudDtcbmZ1bmN0aW9uIGNyZWF0ZUFib3J0Q29udHJvbGxlcigpIHtcbiAgICByZXR1cm4gdHlwZW9mIEFib3J0Q29udHJvbGxlciA9PSAndW5kZWZpbmVkJ1xuICAgICAgICA/IG5ldyBhYm9ydF9jb250cm9sbGVyXzEuZGVmYXVsdCgpXG4gICAgICAgIDogbmV3IEFib3J0Q29udHJvbGxlcigpO1xufVxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/./node_modules/link-preview-js/build/index.js\n");

/***/ })

};
;